$(window).on("load",(function(){var t=d3.select("#sunburst-sequence"),e=t.node().getBoundingClientRect().width,n=Math.min(e,400)/2,r=75,a=30,i=3,l=10,s={home:"#99B898",product:"#FECEA8",search:"#FF847C",account:"#E84A5F",other:"#6C5B7B",end:"#355C7D"},d=0,o=t.append("svg:svg").attr("width",e).attr("height",400).append("svg:g").attr("id","container").attr("transform","translate("+e/2+",200)"),c=d3.layout.partition().size([2*Math.PI,n*n]).value((function(t){return t.size})),u=d3.svg.arc().startAngle((function(t){return t.x})).endAngle((function(t){return t.x+t.dx})).innerRadius((function(t){return Math.sqrt(t.y)})).outerRadius((function(t){return Math.sqrt(t.y+t.dy)}));function p(e){var n=(100*e.value/d).toPrecision(3),c=n+"%";n<.1&&(c="< 0.1%"),d3.select("#percentage").text(c),d3.select("#explanation").style("visibility","");var u=function(t){var e=[],n=t;for(;n.parent;)e.unshift(n),n=n.parent;return e}(e);!function(t,e){var n=d3.select("#trail").selectAll("g").data(t,(function(t){return t.name+t.depth})),d=n.enter().append("svg:g");d.append("svg:polygon").attr("points",v).style("fill",(function(t){return s[t.name]})),d.append("svg:text").attr("x",(r+l)/2).attr("y",a/2).attr("dy","0.35em").attr("text-anchor","middle").text((function(t){return t.name})),n.attr("transform",(function(t,e){return"translate("+e*(r+i)+", 0)"})),n.exit().remove(),d3.select("#trail").select("#endlabel").attr("x",(t.length+.5)*(r+i)).attr("y",a/2).attr("dy","0.35em").attr("text-anchor","middle").text(e),d3.select("#trail").style("visibility","")}(u,c),t.selectAll("path").style("opacity",.3),o.selectAll("path").filter((function(t){return u.indexOf(t)>=0})).style("opacity",1)}function h(e){d3.select("#trail").style("visibility","hidden"),t.selectAll("path").on("mouseover",null),t.selectAll("path").transition().duration(1e3).style("opacity",1).each("end",(function(){d3.select(this).on("mouseover",p)})),d3.select("#explanation").style("visibility","hidden")}function v(t,e){var n=[];return n.push("0,0"),n.push(r+",0"),n.push(r+l+","+a/2),n.push(r+","+a),n.push("0,"+a),e>0&&n.push(l+","+a/2),n.join(" ")}function f(){var t=d3.select("#legend");"hidden"==t.style("visibility")?t.style("visibility",""):t.style("visibility","hidden")}d3.text("../../../app-assets/data/d3/circle/visit-sequences.csv",(function(t){!function(t){d3.select("#sequence").append("svg:svg").attr("width",e).attr("height",50).attr("id","trail").append("svg:text").attr("id","endlabel").style("fill","#000"),r={w:75,h:30,s:3,r:3},a=d3.select("#legend").append("svg:svg").attr("width",r.w).attr("height",d3.keys(s).length*(r.h+r.s)).selectAll("g").data(d3.entries(s)).enter().append("svg:g").attr("transform",(function(t,e){return"translate(0,"+e*(r.h+r.s)+")"})),a.append("svg:rect").attr("rx",r.r).attr("ry",r.r).attr("width",r.w).attr("height",r.h).style("fill",(function(t){return t.value})),a.append("svg:text").attr("x",r.w/2).attr("y",r.h/2).attr("dy","0.35em").attr("text-anchor","middle").text((function(t){return t.key})),d3.select("#togglelegend").on("click",f),o.append("svg:circle").attr("r",n).style("opacity",0);var r,a;var i=c.nodes(t).filter((function(t){return t.dx>.005})),l=o.data([t]).selectAll("path").data(i).enter().append("svg:path").attr("display",(function(t){return t.depth?null:"none"})).attr("d",u).attr("fill-rule","evenodd").style("fill",(function(t){return s[t.name]})).style("opacity",1).on("mouseover",p);d3.select("#container").on("mouseleave",h),d=l.node().__data__.value}(function(t){for(var e={name:"root",children:[]},n=0;n<t.length;n++){var r=t[n][0],a=+t[n][1];if(!isNaN(a))for(var i=r.split("-"),l=e,s=0;s<i.length;s++){var d,o=l.children,c=i[s];if(s+1<i.length){for(var u=!1,p=0;p<o.length;p++)if(o[p].name==c){d=o[p],u=!0;break}u||(d={name:c,children:[]},o.push(d)),l=d}else d={name:c,size:a},o.push(d)}}return e}(d3.csv.parseRows(t)))}))}));