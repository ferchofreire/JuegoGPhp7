$(window).on("load",(function(){var t=d3.select("#stacked-to-grouped"),n=20,a=20,r=30,e=50,i=t.node().getBoundingClientRect().width-e-a,o=500-n-r,d=d3.layout.stack()(d3.range(4).map((function(){return function(t,n){function a(n){for(var a=1/(.1+Math.random()),r=2*Math.random()-.5,e=10/(.1+Math.random()),i=0;i<t;i++){var o=(i/t-r)*e;n[i]+=a*Math.exp(-o*o)}}var r,e=[];for(r=0;r<t;++r)e[r]=n+n*Math.random();for(r=0;r<5;++r)a(e);return e.map((function(t,n){return{x:n,y:Math.max(0,t)}}))}(58,.1)}))),u=d3.max(d,(function(t){return d3.max(t,(function(t){return t.y}))})),c=d3.max(d,(function(t){return d3.max(t,(function(t){return t.y0+t.y}))})),l=d3.scale.ordinal().domain(d3.range(58)).rangeRoundBands([0,i],.08),s=d3.scale.linear().domain([0,c]).range([o,0]),f=d3.scale.linear().domain([0,3]).range(["#FECEA8","#E84A5F"]),g=d3.svg.axis().scale(l).tickSize(0).tickPadding(6).orient("bottom"),h=t.append("svg"),y=h.attr("width",i+e+a).attr("height",o+n+r).append("g").attr("transform","translate("+e+","+n+")"),m=y.selectAll(".layer").data(d).enter().append("g").attr("class","layer").style("fill",(function(t,n){return f(n)})).selectAll(".d3-bar").data((function(t){return t})).enter().append("rect").attr("class","d3-bar").attr("x",(function(t){return l(t.x)})).attr("y",o).attr("width",l.rangeBand()).attr("height",0);m.transition().delay((function(t,n){return 10*n})).attr("y",(function(t){return s(t.y0+t.y)})).attr("height",(function(t){return s(t.y0)-s(t.y0+t.y)})),y.append("g").attr("class","d3-axis d3-xaxis").attr("transform","translate(0,"+o+")").call(g),d3.selectAll("input").on("change",p);var x=setTimeout((function(){d3.select('input[value="grouped"]').property("checked",!0).each(p)}),2e3);function p(){clearTimeout(x),"grouped"===this.value?(s.domain([0,u]),m.transition().duration(500).delay((function(t,n){return 10*n})).attr("x",(function(t,n,a){return l(t.x)+l.rangeBand()/4*a})).attr("width",l.rangeBand()/4).transition().attr("y",(function(t){return s(t.y)})).attr("height",(function(t){return o-s(t.y)}))):(s.domain([0,c]),m.transition().duration(500).delay((function(t,n){return 10*n})).attr("y",(function(t){return s(t.y0+t.y)})).attr("height",(function(t){return s(t.y0)-s(t.y0+t.y)})).transition().attr("x",(function(t){return l(t.x)})).attr("width",l.rangeBand()))}function w(){i=t.node().getBoundingClientRect().width-e-a,h.attr("width",i+e+a),y.attr("width",i+e+a),l.rangeRoundBands([0,i],.08),y.selectAll(".d3-xaxis").call(g),y.selectAll(".d3-bar").attr("x",(function(t){return l(t.x)}))}$(window).on("resize",w),$(".menu-toggle").on("click",w)}));